# Historical Dance: Bibliography

Данный проект ставит целью собрание наиболее полной библиографии по историческим танцам. База данных хранится в формате `.bib` и предполагает интеграцию с пакетами обработки языка разметки LaTeX.

Обработка библиографической базы данных в LaTeX выполняется двумя программами: фронтэндом (на стороне LaTeX) и бэкэндом (именно бэкэнд считывает базу данных и преобразует её в формат, понятный LaTeX'у). Теоретически, можно использовать любую существующую связку (фронтэнд + бэкэнд), официально поддерживается `(biblatex + biber)`. Кроме базы данных, реализованы собственные стилевые файлы.

Для удобства пользования базой данных запущен [специальный сайт](https://bib.hda.org.ru/bib).

Кроме этого в проект включены некоторые транскрипции танцевальных источников в формате [markdown](http://daringfireball.net/projects/markdown/syntax). Некоторые правила оформления данных источников описаны ниже.

## Использование в LaTeX

Нужно установить пакеты `biblatex`, `biblatex-gost` и `biber` (все пакеты есть в стандартных репозиториях). Стилевой файл подключается так:

	\newcommand{\rootfolder}{%folderpath%}
	\usepackage[root=\rootfolder]{\rootfolder/dancebooks-biblatex}

Опционально доступен параметр `usedefaults`, принимающий значения `true` и `false`. При указании значения `false` источники танцевальной библиографии (`.bib`-файлы из состава проекта) не подключаются. Позволяет использовать стилевой файл из дистрибутива в других проектах. Пример использования опции:

	\newcommand{\rootfolder}{%folderpath%}
	\usepackage[usedefaults=false,root=\rootfolder]{\rootfolder/dancebooks-biblatex}

После подключения становятся доступны макросы цитирования `\cite`, `\footcite`, `\parencite`, `\nocite`, `\volcite`. Работа макросов описана в [руководстве по biblatex](http://mirrors.ctan.org/macros/latex/contrib/biblatex/doc/biblatex.pdf). Стандартный макрос печати библиографии в `biblatex` -- `\printbibliography`, без параметров. Дополнительные библиографические источники можно добавить стандартной командой `\addbibresource{hello.bib}`.

Порядок компиляции такой:

1. `pdflatex project.tex`
2.	`biber --listsep=\| --namesep=\| --quiet project` (в POSIX окружении)

	`biber "--listsep=|" "--namesep=|" "test-biblatex"` (в Windows)
3. `pdflatex project.tex`

В версии 1.9 была добавлена поддержка `lualatex` (`xelatex` не поддерживается). Порядок компиляции аналогичен:

1. `lualatex project.tex`
2.	`biber '--listsep=|' '--namesep=|' '--xsvsep=\s*\|\s*' --mssplit=# project` (в POSIX окружении)

	`biber "--listsep=|" "--namesep=|" "test-biblatex" "--xsvsep=\s*\|\s*" "--mssplit=#" project` (в Windows)
3. `lualatex project.tex`

## Информация о структуре базы данных

Согласно соглашениям, наследованным от библиографических стилей `ГОСТ 7.0.5-2008` имя автора и другие метаданные указываются на языке, локальном к месту издания книги на момент её издания (метаданные русскоязычных книг переводятся в современную орфографию).

### Поддержка множества ссылок

Библиография поддерживает множество ссылок на одну и ту же книгу. Правила расстановки таковы:

1. Если книга не выложена в свободный доступ, то ссылка отсутствует.
2. 
    Если книга доступна на ресурсах-агрегаторах ([archive.org](https://archive.org), [Google Books](https://books.google.com), [HathiTrust](http://www.hathitrust.org)), ставится ссылка на ресурс-агрегатор. Таких ссылок может быть не больше одной.
    
	Порядок замещения ссылок между агрегаторами следующий (нижняя ссылка замещает верхнюю):
	1. Google Books
	2. HathiTrust
	3. archive.org
3. Если книга лежит на официальном сайте какой-либо библиотеки, то такая ссылка проставляется в библиографию.
4. Если ссылки из пункта 3 не имеют известных дефектов, такие ссылки вытесняют ссылку из пункта 2. Информация о дефектах заносится в поле `annotation`.
5. Ссылки из пункта 3 вытесняют ссылки, предоставляемые самой библиографией.
6. Максимальное число копий одной книги не может превышать 3.

### Поддержка множества имён

Библиография поддерживает множество имён для одного и того же автора. Этот функционал предназначен для решения следующих проблем:

1. Используя оригинальное имя автора становится возможным поиск переводов его книг (за это отвечает поле `origauthor`).
2. Становится возможным поиск автора по его псевдониму (за это отвечает поле `pseudo_author`).
3. Становится возможным поиск автора по версии имени, которая указана на титульной странице книги или по той версии, которая сложилась в научной традиции (за это отвечает поле `altauthor`). `altauthor` прописывается только в том случае, когда известно настоящее имя автора.

В имени файла (поле `filename`) при этом может быть указано любое из этих имён.

### Особенности проставления поля `publisher`

Исторически сложилось так, что в поле `publisher` может быть указан издатель (человек, оплативший публикацию книги, но при этом не являющийся её единоличными автором). Издателя можно определить по наличию ключевых слов `herausgegeben von`, `printed for` и так далее.

Если издатель неизвестен, в поле `publisher` может быть указана типография или имя печатника, занимавшаяся печатью книги. Такие поля определяются словами `druckt`, `printed at`, printed by`, `imprimé par` и так далее.

Широко распространённой является практика, при которой на титульном листе книги указывается не издатель, а книгопродавец. Ввиду невозможности доказать причастность книгопродавца к изданию книги, данная информация не включается в библиографию.

## Особенности датировки

В поле `date` проставляется датировка конкретного экземпляра книги в соответствии с [правилами](https://github.com/hda-technical/docs/blob/master/common.md#dating). В случае с нотными изданиями, тираж которых мог допечатываться без изменения содержания, но с изменениями титульной страницы, также ставится датировка конкретного экземпляра книги.

При невозможности установить датировку экземпляра проставляется дата цензорской отметки.

Не всякое издание можно датировать точно. Зачастую с уверенностью можно назвать лишь столетие или другой доверительный интервал. Для источников, для которых точная датировка не представляется возможной, в поле `annotation` хранится информация о том, почему был выбран тот или иной доверительный интервал.

## О транскрипциях

Все транскрипции хранятся в формате [`markdown`](http://daringfireball.net/projects/markdown/syntax), дополнительно включены расширения [footnotes](http://pythonhosted.org/Markdown/extensions/footnotes.html), [tables](http://pythonhosted.org/Markdown/extensions/tables.html).

Файлы транскрипций находятся в кодировке UTF-8, используются UNIX-like окончания строк.

Транскрипции доступны для просмотра в веб-интерфейсе библиографии.

Возможны и некоторые другие специфичные для каждой транскрипции в отдельности изменения.

## О тегах

Полный список тегов с пояснениями доступен на [сайте библиографии](https://bib.hda.org.ru/bib/keywords.html).

## О возможностях, не имеющих поддержки в интерфейсе

1. Поиск по ключевому слову можно инвертировать, поставив перед ним восклицательный знак:
	* `keywords=waltz,quadrille` — ищет все книги про вальс И про кадрили
	* `keywords=waltz,!quadrille` — ищет все книги про вальс, но без кадрилей
	* `keywords=!waltz,!quadrille` — ищет все книги, которые не упоминают ни вальса, ни кадрилей

2. Любой поиск можно экспортировать в простенький CSV, если дописать в поиск параметр `format=csv`

## О типах записей

В библиографии выделяются следующие типы записей.

* `unpublished` — манускрипт или архивный материал, существующий в единственном экземпляре. Имеет:
	* Поле `library` с указанием института, где хранится объект (архив, библиотека или их подразделение)
	* Поле `library_location` с указанием города, в котором находится библиотека
	* Поле `library_code` с каталожным кодом объекта
* `periodical` — периодическое издание (журнал). Имеет:
	* Точную дату публикации, указанную в полях `year`, `month`, `day`.
	* Поле `number` в значении _номер журнала_ (может отсчитываться относительно начала года)
	* Поле `volume` в значении _порядковый год публикации журнала_
* `article` — статья в газете или журнале. Имеет:
	* Ссылку на соответствующий `periodical` в поле `crossref` (если журнал присутствует в библиографии)
	* Поле `pages` с указанием номеров страниц в журнале
	* Поле `journaltitle` с указанием полного названия журнала
* `proceedings` — сборник статей с конференции
* `inproceedings` — статья в сборнике статей с конференции. Имеет:
	* Ссылку на соответствующий `proceedings` в поле `crossref`
	* Поле `pages` с указанием номеров страниц в сборнике
	* Поле `booktitle` с указанием полного названия сборника
* `reference` — словарь или энциклопедия, содержащая множество независимых статей
* `mvreference` — многотомный словарь или энциклопедия. Имеет:
	* Поле `volumes` с указанием числа томов
* `thesis` — диссертация. Имеет:
	* Поле `type` с указанием степени (например, `Master of Arts Thesis`)
	* Поле `institution` с указанием учебного заведения, в котором данная диссертация была защищена
* `collection` — сборник статей разных авторов, объединенный общей тематикой, но не связанный с какой-либо конференцией
* `incollection` — статья в сборнике статей типа `collection`. Имеет:
	* Ссылку на соответствующий `collection` в поле `crossref`
	* Поле `pages` с указанием номеров страниц в сборнике
	* Поле `booktitle` с указанием полного названия сборника
* `book` — книга и прочие записи, не подходящие под другие категории (в частности, к этой категории относятся сборники нот)
* `mvbook` — многотомная книга. Имеет:
	* Поле `volumes` с указанием числа томов
* `inbook` — самостоятельная часть книги, не предполагающая независимой продажи. Как правило, имеет независимую нумерацию страниц. Имеет:
	* Ссылку на соответствующую книгу в поле `crossref`
	* Поле `booktitle` с указанием полного названия сборника
